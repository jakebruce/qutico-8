pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
--break...out!
--by jake

function _init()
	shake=0
	reset_game()
end

function reset_game()
	score=0
	lives=3	
	paddle=make_paddle()
	ball=make_ball()
	entities={paddle,ball}
	make_bricks()	
end
-->8
--updates

function _update60()
	if (pause and time()-pause_time<2) return
	pause=false
	
	for e in all(entities) do
		if (e.update) e:update()
	end
end

function update_particle(s)
	s.vx+=(rnd()-0.5)*0.1
	s.vy+=(rnd()-0.5)*0.1
	s.x+=s.vx
	s.y+=s.vy
	s.l-=1
	if (s.l<0 and rnd()<0.1) del(entities,s)
end

function update_debris(s)
	s.vy+=0.1
	s.x+=s.vx
	s.y+=s.vy
	if (s.y>128) del(entities,s)
end

function update_paddle(s)
	if     btn(⬅️) then s.v-=s.a
	elseif btn(➡️) then s.v+=s.a
	elseif abs(s.v)>0.01 then
		s.v-=sgn(s.v)*s.a
	end
	
	s.v=mid(-s.max_v,s.v,s.max_v)
	s.x+=s.v
	s.x=mid(s.w/2,s.x,128-s.h/2)
end

function gameover()
	shake+=1.0
	sfx(4)
	pause=true
	pause_time=time()
	_init()
end

function die()
	shake+=0.5
	lives-=1
	if (lives<1) return gameover()
	ball.x=63
	ball.y=63
	sfx(3)
end

function update_ball(s)
	s.x+=s.dx
	s.y+=s.dy
	collide_ball(s)
	if (s.y+s.r>=128) die()
	if (rnd()<0.15) add(entities,make_particle(s.x,s.y))
end

function collide_ball(s)
	return (collide_paddle(s)   or
									collide_entities(s) or
									collide_walls(s))
end

function collide_entities(s)
 for e in all(entities) do
		if e.collider then
		 if  abs(e.y-s.y)<=s.r+e.h/2+1
		 and abs(e.x-s.x)<=s.r+e.w/2+1
		 then
		 	if s.dy<0 then
		 		s.y+=3
		 		s.dy*=-1
		 	elseif s.dy>0 then
		 		s.y-=3
		 		s.dy*=-1
		 	end
		 	for i=1,ceil(rnd(20)) do
		 		add(entities,make_debris(e.x,e.y))
		 	end
		 	score+=e.c
		 	sfx(2)
		 	shake+=0.2
		 	del(entities,e)
		 	return
		 end
	 end
	end
end

function collide_paddle(s)
	p=paddle
	if  abs(p.y-s.y)<=s.r+p.h/2
	and abs(p.x-s.x)<=s.r+p.w/2
	then
		s.y-=1
		s.dy*=-1
		sfx(0)
		shake+=0.1
		return true
	end
end

function collide_walls(s)
	if s.x>=128 then
		s.x-=1
		s.dx*=-1
		sfx(1)
		shake+=0.1
		return true
	elseif s.x<=0 then
		s.x+=1
		s.dx*=-1
		sfx(1)
		shake+=0.1
		return true
	elseif s.y<=0 then
		s.y+=1
		s.dy*=-1
		sfx(1)
		shake+=0.1
		return true
	end	
end
-->8
--draws

function _draw()
	cls()
	draw_shake()
	draw_level()
	draw_ui()
	for e in all(entities) do
		e:draw()
	end
	if (pause) draw_gameover()
end

function draw_particle(s)
	pset(s.x,s.y,s.c)
end

function draw_debris(s)
	spr(s.s,s.x,s.y)
end

function draw_shake()
	x=16-rnd(32)
	y=16-rnd(32)
	shake*=0.9
	shake_x=shake*x
	shake_y=shake*y
	if (shake<0.05) shake=0
	camera(shake_x,shake_y)
end

function rectshad(x1,y1,x2,y2,c)
	rectfill(x1+1,y1+1,x2+1,y2+1,0)
	rectfill(x1,y1,x2,y2,c)
end

function circshad(x,y,r,c)
	circfill(x+1,y+1,r,0)
	circfill(x,y,r,c)
end

function draw_gameover()
	rectshad(16,32,128-16,128-32,8)
	print("game over!",25,63-3,0)
	print("restarting... "..(time()-pause_time-2),20,63-3+16,0)
end

function draw_ui()
	rectfill(0,0,128,6,0)
	print("lives: "..lives.."  score: "..score,1,1,6)
end

function draw_level()
	rectfill(0,0,128,128,1)
end

function draw_paddle(s)
	rectshad(s.x-s.w/2,s.y-s.h/2,s.x+s.w,s.y+s.h,s.c)
end

function draw_ball(s)
	circshad(s.x,s.y,s.r,s.c)
end

function draw_brick(s)
	rectshad(s.x-s.w/2,s.y-s.h/2,s.x+s.w,s.y+s.h,s.c)
end
-->8
--entities

function make_paddle()
	return {
		x=60,
		y=122,
		v=0,
		a=1,
		max_v=3,
		w=20,
		h=3,
		c=8,
		update=update_paddle,
		draw=draw_paddle,
	}
end

function make_bricks()
	for row=1,3 do
		for col=1,8 do
			add(entities, {
				x=col*14-2,
				y=row*8+8,
				w=8,
				h=4,
				collider=true,
				c=flr(rnd(14)+2),
				draw=draw_brick,
			})
		end
	end
end

function make_ball()
	return {
		x=63,
		y=63,
		dx=0.8,
		dy=0.8,
		r=3,
		c=10,
		update=update_ball,
		draw=draw_ball,
	}
end

function make_particle(x,y)
	return {
		x=x,
		y=y,
		vx=rnd(0.5)-0.25,
		vy=rnd(0.5)-0.25,
		c=rnd({8,9,10}),
		l=60,
		update=update_particle,
		draw=draw_particle,
	}
end

function make_debris(x,y)
	return {
		x=x,
		y=y,
		vx=rnd(2)-1,
		vy=rnd(2)-1,
		s=ceil(rnd(10)),
		update=update_debris,
		draw=draw_debris,
	}
end
__gfx__
00000000000000000000000000000000000005000000000000000000065000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000005000000006500650000000000050666000000006000000000000000000600000000000000000000000000000000000000000
00700700000055500000000000065000000066650665000000005660666500000066000006500000000000650000000000000000000000000000000000000000
00077000000666000000000000065000000000600666500000006600006600000060000006665000000000050000000000000000000000000000000000000000
00077000000660000050000000660000000000000666600000006600000000000060000000066000000000000000000000000000000000000000000000000000
00700700000000000650000000000000000000000060000000006050000000000000000000000000000000000000000000000000000000000000000000000000
__label__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06000666060606660066000000000666000000000066006600660666066600000000066606660000000000000000000000000000000000000000000000000000
06000060060606000600006000000006000000000600060006060606060000600000000600060000000000000000000000000000000000000000000000000000
06000060060606600666000000000066000000000666060006060660066000000000000600660000000000000000000000000000000000000000000000000000
06000060066606000006006000000006000000000006060006060606060000600000000600060000000000000000000000000000000000000000000000000000
06660666006006660660000000000666000000000660006606600606066600000000000606660000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111fffffffffffff12222222222222144444444444441aaaaaaaaaaaaa1ccccccccccccc1fffffffffffff1bbbbbbbbbbbbb13333333333333111111111
11111111fffffffffffff02222222222222044444444444440aaaaaaaaaaaaa0ccccccccccccc0fffffffffffff0bbbbbbbbbbbbb03333333333333011111111
11111111fffffffffffff02222222222222044444444444440aaaaaaaaaaaaa0ccccccccccccc0fffffffffffff0bbbbbbbbbbbbb03333333333333011111111
11111111fffffffffffff02222222222222044444444444440aaaaaaaaaaaaa0ccccccccccccc0fffffffffffff0bbbbbbbbbbbbb03333333333333011111111
11111111fffffffffffff02222222222222044444444444440aaaaaaaaaaaaa0ccccccccccccc0fffffffffffff0bbbbbbbbbbbbb03333333333333011111111
11111111fffffffffffff02222222222222044444444444440aaaaaaaaaaaaa0ccccccccccccc0fffffffffffff0bbbbbbbbbbbbb03333333333333011111111
11111111fffffffffffff02222222222222044444444444440aaaaaaaaaaaaa0ccccccccccccc0fffffffffffff0bbbbbbbbbbbbb03333333333333011111111
11111111100000000000001000000000000010000000000000100000000000001000000000000010000000000000100000000000001000000000000011111111
11111111555555555555511111111111111199999999999991111111111111116666666666666133333333333331666666666666611111111111111111111111
11111111555555555555501111111111111199999999999990111111111111116666666666666033333333333330666666666666601111111111111111111111
11111111555555555555501111111111111199999999999990111111111111116666666666666033333333333330666666666666601111111111111111111111
11111111555555555555501111111111111199999999999990111111111111116666666666666033333333333330666666666666601111111111111111111111
11111111555555555555501111111111111199999999999990111111111111116666666666666033333333333330666666666666601111111111111111111111
11111111555555555555501111111111111199999999999990111111111111116666666666666033333333333330666666666666601111111111111111111111
11111111555555555555501111111111111199999999999990111111111111116666666666666033333333333330666666666666601111111111111111111111
11111111100000000000001111111111111110000000000000111111111111111000000000000010000000000000100000000000001111111111111111111111
11111111111111111111111111111111111199999999999991111111111111111111111111111111111111111111aaaaaaaaaaaaa11111111111111111111111
11111111111111111111111111111111111199999999999990111111111111111111111111111111111111111111aaaaaaaaaaaaa01111111111111111111111
11111111111111111111651111111111111199999999999990111111111111111111111111111111111111111111aaaaaaaaaaaaa01111111111111111111111
1111111111111111111666a111111111111199999999999990111111111111111111111111111111111111111111aaaaaaaaaaaaa01111111111111111111111
11111111111111111115555111111111111199999999999990161111111111111111111111111111111111111111aaaaaaaaaaaaa01111111111111111111111
11111111111111111166666111111111111199995559999990165111111111111111111111111111111111111111aaaaaaaaaaaaa01111111111111111111111
11111111111111111166111111111111111199966699999990115111111111111111111111111111111111111111aaaaaaaaaaaaa01111111111111111111111
11111111111111111111111111111111111110066000000000111111111111111111111111111111111111111111100000000000001111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111165111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111166651111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111811111111111111111111661111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111181111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11aaa111111111111111111111111111111111111111651111111111111111111111111111111111111111111111111111111111111111111111111111111111
1aaaaa11111111111111111111111111111111111116661111111111111111111111111111111111111111111111111111111111111111111111111111111111
aaa8aaa1111111111111111111111111111111111116665111111111111111111111111111111111111111111111111111111111111111111111111111111111
aaaaaaa0111111111111111111111111111111111111166111111111111111111111111111111111111111111111111111111111111111111111111111111111
aaaaaaa0111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
1aaaaa00111111111555111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11aaa001111111116661111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11100011111111116611111111111111111111111111111111111111111111111118111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111511111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111156611111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111166111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
111111111111111111111111111111111661111111111111111a1111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111161511111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111161111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111165111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111115111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111116511111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111166611111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111166651111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111661111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111555111111111111611111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111116661111111111111651111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111115116611111111111111151111651111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111165111111111111111111111111665111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111116165111111111111111111111111666511111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111166661111111111111111111111111666511111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111161111111111111111111111111111166511111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111161111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111188888888888888888888888888888881111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111188888888888888888888888888888880111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111188888888888888888888888888888880111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111188888888888888888888888888888880111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111188888888888888888888888888888880111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111188888888888888888888888888888880111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111

__map__
0000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000400001605000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000400001d05000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000400002205000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0002000036050360502b0502a050300502f0502405024050270502a0502b050290501a0501a0501f05020050120501205012050140500f0500605005050080500b0500b050030500205002050010500005000050
0008000030010300103002033020330203403034030340402f050250501d0601c0601b0601b0601b0601b0601a06017060130600e0600e0500e0500e0500e0400d04007030010200002000050000000000000000
